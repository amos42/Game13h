;*****************************************
;
;     모드 13h용 게임 작성 라이브러리
;                       Ver 4.2
;
;                 제작자:
;                        주 경 민
;
;  게임 작성을 위해 만든 라이브러리로서
; 모드 13h (320x200, 256) 전용이다.
;
;*****************************************
IDEAL
include "game13h.inc"


UDATASEG

  temp_pal palette_data <>


DATASEG

  _change_palette_flag dw TRUE
  _palette palette_data < 0, 0, 0 >
           db           00,00,42, 00,42,00, 00,42,42, 42,00,00, 42,00,42
           db 42,21,00, 42,42,42, 21,21,21, 21,21,63, 21,63,21, 21,63,63
           db 63,21,21, 63,21,63, 63,63,21, 63,63,63, 59,59,59, 55,55,55
           db 52,52,52, 48,48,48, 45,45,45, 42,42,42, 38,38,38, 35,35,35
           db 31,31,31, 28,28,28, 25,25,25, 21,21,21, 18,18,18, 14,14,14
           db 11,11,11, 08,08,08, 63,00,00, 59,00,00, 56,00,00, 53,00,00
           db 50,00,00, 47,00,00, 44,00,00, 41,00,00, 38,00,00, 34,00,00
           db 31,00,00, 28,00,00, 25,00,00, 22,00,00, 19,00,00, 16,00,00
           db 63,54,54, 63,46,46, 63,39,39, 63,31,31, 63,23,23, 63,16,16
           db 63,08,08, 63,00,00, 63,42,23, 63,38,16, 63,34,08, 63,30,00
           db 57,27,00, 51,24,00, 45,21,00, 39,19,00, 63,63,54, 63,63,46
           db 63,63,39, 63,63,31, 63,62,23, 63,61,16, 63,61,08, 63,61,00
           db 57,54,00, 51,49,00, 45,43,00, 39,39,00, 33,33,00, 28,27,00
           db 22,21,00, 16,16,00, 52,63,23, 49,63,16, 45,63,08, 40,63,00
           db 36,57,00, 32,51,00, 29,45,00, 24,39,00, 54,63,54, 47,63,46
           db 39,63,39, 32,63,31, 24,63,23, 16,63,16, 08,63,08, 00,63,00
           db 00,63,00, 00,59,00, 00,56,00, 00,53,00, 01,50,00, 01,47,00
           db 01,44,00, 01,41,00, 01,38,00, 01,34,00, 01,31,00, 01,28,00
           db 01,25,00, 01,22,00, 01,19,00, 01,16,00, 54,63,63, 46,63,63
           db 39,63,63, 31,63,62, 23,63,63, 16,63,63, 08,63,63, 00,63,63
           db 00,57,57, 00,51,51, 00,45,45, 00,39,39, 00,33,33, 00,28,28
           db 00,22,22, 00,16,16, 23,47,63, 16,44,63, 08,42,63, 00,39,63
           db 00,35,57, 00,31,51, 00,27,45, 00,23,39, 54,54,63, 46,47,63
           db 39,39,63, 31,32,63, 23,24,63, 16,16,63, 08,09,63, 00,01,63
           db 00,00,63, 00,00,59, 00,00,56, 00,00,53, 00,00,50, 00,00,47
           db 00,00,44, 00,00,41, 00,00,38, 00,00,34, 00,00,31, 00,00,28
           db 00,00,25, 00,00,22, 00,00,19, 00,00,16, 60,54,63, 57,46,63
           db 54,39,63, 52,31,63, 50,23,63, 47,16,63, 45,08,63, 42,00,63
           db 38,00,57, 32,00,51, 29,00,45, 24,00,39, 20,00,33, 17,00,28
           db 13,00,22, 10,00,16, 63,54,63, 63,46,63, 63,39,63, 63,31,63
           db 63,23,63, 63,16,63, 63,08,63, 63,00,63, 56,00,57, 50,00,51
           db 45,00,45, 39,00,39, 33,00,33, 27,00,28, 22,00,22, 16,00,16
           db 63,58,55, 63,56,52, 63,54,49, 63,53,47, 63,51,44, 63,49,41
           db 63,47,39, 63,46,36, 63,44,32, 63,41,28, 63,39,24, 60,37,23
           db 58,35,22, 55,34,21, 52,32,20, 50,31,19, 47,30,18, 45,28,17
           db 42,26,16, 40,25,15, 39,24,14, 36,23,13, 34,22,12, 32,20,11
           db 29,19,10, 27,18,09, 23,16,08, 21,15,07, 18,14,06, 16,12,06
           db 14,11,05, 10,08,03, 00,00,00, 60,52,16, 60,48,12, 52,40,08
           db 48,32,04, 40,24,00, 36,16,04, 32,12,00, 49,10,10, 49,19,10
           db 49,29,10, 49,39,10, 49,49,10, 39,49,10, 29,49,10, 19,49,10
           db 10,49,12, 10,49,23, 10,49,34, 10,49,45, 10,42,49, 10,31,49
           db 10,20,49, 11,10,49, 22,10,49, 33,10,49, 44,10,49, 49,10,43
           db 49,10,32, 49,10,21, 49,10,10, 63,63,63


CODESEG

;***********************************
;  DAC에서 팔레트 정보를 읽어온다.
; palette_data get_palette( byte color_no )
;***********************************
proc get_palette  color_no:byte
  mov al, [color_no]
  mov dx, 3C7h
  out dx, al
  mov dx, 03C9h

  in al, dx
  mov [temp_pal.red], al
  in al, dx
  mov [temp_pal.green], al
  in al, dx
  mov [temp_pal.blue], al

  mov dx, seg temp_pal
  mov ax, offset temp_pal

  ret
endp
global get_palette : proc


;**********************
;  팔려트를 설정한다.
; void set_palette( byte color_no, char red, char green, char blue )
;**********************
proc set_palette  color_no:byte, red:byte, green:byte, blue:byte
  mov al, [color_no]
  mov dx, 03C8h
  out dx, al

  inc dx
  mov al, [red]
  out dx, al
  mov al, [green]
  out dx, al
  mov al, [blue]
  out dx, al

  ret
endp
global set_palette : proc


END
